<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°œì¸ ë§ì¶¤ ì»¤ë¦¬í˜ëŸ¼</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 30px; background: #f5f7fa; color: #333; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 10px; }
        .sub-title { text-align: center; color: #666; margin-bottom: 40px; font-size: 1.1em; }
        
        .card-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        
        .card {
            background: white; border-radius: 12px; padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s; cursor: pointer;
            border: 2px solid transparent;
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .card:hover { transform: translateY(-5px); border-color: #007ACC; }
        
        /*  DAY ë¼ë²¨ ìŠ¤íƒ€ì¼ */
        .day-label { font-size: 0.9em; color: #888; margin-bottom: 10px; font-weight: bold; text-transform: uppercase; }
        .topic { font-size: 1.3em; font-weight: bold; color: #333; margin-bottom: 10px; word-break: keep-all; }
        .desc { color: #666; line-height: 1.5; font-size: 0.95em; }
        .icon { font-size: 2.5em; margin-bottom: 15px; text-align: center; display: block;}

        /* ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ */
        .empty-state { text-align: center; margin-top: 100px; color: #777; }
        .empty-state i { font-size: 4em; color: #ccc; margin-bottom: 20px; display: block; }

        /* ì„ íƒ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #choice-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 15px; width: 500px; text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: popIn 0.3s; position: relative;
        }
        @keyframes popIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }
        
        .choice-btn-container { display: flex; gap: 20px; margin-top: 25px; justify-content: center; }
        .choice-btn {
            flex: 1; padding: 20px; border: 2px solid #eee; border-radius: 10px; background: #fff;
            cursor: pointer; transition: all 0.2s; font-size: 1.1em; font-weight: bold; color: #555;
        }
        .choice-btn:hover { border-color: #007ACC; background: #f0f7ff; color: #007ACC; }
        
        #result-area { 
            margin-top: 20px; text-align: left; background: #f9f9f9; padding: 20px; 
            border-radius: 8px; display: none; max-height: 400px; overflow-y: auto;
            border: 1px solid #eee;
        }
        #result-area h3 { margin-top: 0; color: #007ACC; font-size: 1.2em; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        #result-area ul { padding-left: 20px; }
        #result-area li { margin-bottom: 15px; }
        
        .close-btn { 
            margin-top: 20px; padding: 8px 25px; border: none; background: #eee; 
            cursor: pointer; border-radius: 5px; font-weight: bold; color: #555;
        }
        .close-btn:hover { background: #ddd; }
    </style>
</head>
<body>

    <h1>ğŸŒŸ ê°œì¸ ë§ì¶¤í˜• CO-FT ì»¤ë¦¬í˜ëŸ¼</h1>
    <div class="sub-title" id="sub-title">ë‚˜ì˜ ì·¨ì•½ì ì„ ì™„ë²½í•˜ê²Œ ë³´ì™„í•˜ëŠ” í•™ìŠµ í”Œëœ</div>

    <div id="loading" style="text-align:center; margin-top:50px; font-size:1.2em; color:#666;">
        ì·¨ì•½ ê°œë…ì„ ë¶„ì„í•˜ì—¬ ì»¤ë¦¬í˜ëŸ¼ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤... â³
    </div>
    
    <div class="card-container" id="container"></div>

    <div id="empty-msg" class="empty-state" style="display: none;">
        <i>ğŸ‰</i>
        <h2>ë“±ë¡ëœ ì·¨ì•½ ê°œë…ì´ ì—†ìŠµë‹ˆë‹¤!</h2>
        <p>ë¬¸ì œë¥¼ í’€ê³  ì˜¤ë‹µ ë…¸íŠ¸ê°€ ìŒ“ì´ë©´<br>ì—¬ê¸°ì— ë§ì¶¤ ì»¤ë¦¬í˜ëŸ¼ì´ ìƒì„±ë©ë‹ˆë‹¤.</p>
    </div>

    <div id="choice-modal">
        <div class="modal-content">
            <h2 id="modal-title" style="margin-top:0;">í•™ìŠµ ë°©ë²• ì„ íƒ</h2>
            <p style="color:#666;">ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ í•™ìŠµí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            
            <div class="choice-btn-container" id="buttons-area">
                <button class="choice-btn" onclick="selectType('video')">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">ğŸ“º</div>
                    ì˜ìƒ í•™ìŠµ
                </button>
                <button class="choice-btn" onclick="selectType('problem')">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">ğŸ“</div>
                    ë¬¸ì œ í’€ì´
                </button>
            </div>

            <div id="modal-loading" style="display:none; margin:30px 0; color:#007ACC; font-weight:bold;">
                CO-FTê°€ ë§ì¶¤ ì»¨í…ì¸ ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤... â³
            </div>
            
            <div id="result-area"></div>

            <button class="close-btn" onclick="closeModal()">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        // URLì—ì„œ ì·¨ì•½ ê°œë… ë¦¬ìŠ¤íŠ¸ íŒŒì‹±
        const params = new URLSearchParams(window.location.search);
        const concepts = JSON.parse(params.get('concepts') || '[]');
        
        let currentTopic = '';

        async function init() {
            // [ìˆ˜ì •] ì·¨ì•½ ê°œë…ì´ ì—†ìœ¼ë©´ ë°”ë¡œ ë¹ˆ ìƒíƒœ í‘œì‹œ (ê¸°ë³¸ê°’ ì œê±°)
            if (concepts.length === 0) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('empty-msg').style.display = 'block';
                document.getElementById('sub-title').innerText = "í˜„ì¬ í•™ìŠµì´ í•„ìš”í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
                return;
            }

            // ì·¨ì•½ ê°œë…ì´ ìˆìœ¼ë©´ AIì—ê²Œ ìš”ì²­ (ë”± ê·¸ ê°œìˆ˜ë§Œí¼ë§Œ)
            try {
                const plan = await ipcRenderer.invoke('generate-curriculum', concepts);
                render(plan);
            } catch (e) {
                document.getElementById('loading').innerHTML = "ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì‹¤íŒ¨: " + e.message;
            }
        }

        function render(plan) {
            const container = document.getElementById('container');
            document.getElementById('loading').style.display = 'none';
            
            if (!plan || plan.length === 0) {
                document.getElementById('empty-msg').style.display = 'block';
                return;
            }

            const icons = ['ğŸŒ±', 'ğŸŒ¿', 'ğŸŒ³', 'ğŸ”¥', 'ğŸ’§', 'âš¡', 'ğŸŒˆ', 'â­', 'ğŸ†', 'ğŸ‘‘'];

            plan.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = 'card';
                // [ìš”ì²­ ë°˜ì˜] DAY + ë²ˆí˜¸ë¡œ í‘œì‹œ
                div.innerHTML = `
                    <div>
                        <div class="icon">${icons[idx % icons.length]}</div>
                        <div class="day-label">DAY ${idx + 1}</div>
                        <div class="topic">${item.topic}</div>
                        <div class="desc">${item.desc}</div>
                    </div>
                    <div style="margin-top:15px; text-align:right; font-weight:bold; color:#007ACC;">í•™ìŠµ ì‹œì‘í•˜ê¸° â†’</div>
                `;
                div.onclick = () => openModal(item.topic);
                container.appendChild(div);
            });
        }

        function openModal(topic) {
            currentTopic = topic;
            document.getElementById('modal-title').innerText = `'${topic}' í•™ìŠµ`;
            document.getElementById('choice-modal').style.display = 'flex';
            
            document.getElementById('buttons-area').style.display = 'flex';
            document.getElementById('modal-loading').style.display = 'none';
            document.getElementById('result-area').style.display = 'none';
            document.getElementById('result-area').innerHTML = '';
        }

        function closeModal() {
            document.getElementById('choice-modal').style.display = 'none';
        }

        async function selectType(type) {
            document.getElementById('buttons-area').style.display = 'none';
            document.getElementById('modal-loading').style.display = 'block';

            try {
                const content = await ipcRenderer.invoke('request-learning-content', { 
                    topic: currentTopic, 
                    type: type 
                });

                document.getElementById('modal-loading').style.display = 'none';
                const resultDiv = document.getElementById('result-area');
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = content;
            } catch (e) {
                document.getElementById('modal-loading').style.display = 'none';
                alert("ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                document.getElementById('buttons-area').style.display = 'flex';
            }
        }

        init();
    </script>
</body>
</html>
